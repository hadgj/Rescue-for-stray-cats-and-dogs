<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>流浪猫狗救助平台</title>
    <!-- css files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/newsdetails.css">
    <script src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/include.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/axios-0.18.0.js"></script>
	<!-- Style-CSS -->
</head>
<body>
    <!-- 导航栏出现 -->
    <div id="header"></div>
    <!-- //导航栏结束 -->

    <!-- 文章详情页 -->
    <div class="w clearfix">
    <div id="app">
    <div class="middle">
    <div class="middleh">
        文章详情
    </div>
    <div class="middleb">
        <div class="box">
            <div class="box-1">
                <ul>
                    <li v-for="(img,index) in imgnames" :key="index" >
                        <img :src="'/file/'+img"/>
                        <h2>文章美图</h2>
                    </li>
                </ul>
            </div>
            <div class="box-2">
                <ul>
                    
                </ul>
            </div>
            <div class="box-3">
                <span class="prev"> < </span>
                <span class="next"> > </span>
            </div>
        </div>
    </div>
    <div class="middlec">
        <div class="title">
            <h1>{{news1.newsTitle}}</h1>
        </div>
        <div class="content">
            <div class="time">
                <span>发布时间：{{news1.newsDate}}</span>
                <span><img id="zan" :src="src" alt="" v-on:click="editsrc">{{news1.newsZan}}</span>
            </div>
            <div class="wenzi">
                <p class="firstp">
                    {{news1.newsContent}}
                </p>
            </div>
            
        </div>
    </div>
    </div>
    <div class="bottom">
        <div id="qq">
            <p>有什么新鲜事想告诉大家?</p>
            <div class="message" contentEditable='true'></div>
            <div class="But">
                <img src="biaoqing/bba_thumb.gif" class='bq' v-on:click="bqzhan($event)"/>
                <span class='submit' v-on:click="pinglun">发表</span>
                <!--face begin-->
                <div class="face">
                    <ul>
                        <li><img src="biaoqing/smilea_thumb.gif" title="呵呵]"></li>
                        <li><img src="biaoqing/tootha_thumb.gif" title="嘻嘻]"></li>
                        <li><img src="biaoqing/laugh.gif" title="[哈哈]"></li>
                        <li><img src="biaoqing/tza_thumb.gif" title="[可爱]"></li>
                        <li><img src="biaoqing/kl_thumb.gif" title="[可怜]"></li>
                        <li><img src="biaoqing/kbsa_thumb.gif" title="[挖鼻屎]"></li>
                        <li><img src="biaoqing/cj_thumb.gif" title="[吃惊]"></li>
                        <li><img src="biaoqing/shamea_thumb.gif" title="[害羞]"></li>
                        <li><img src="biaoqing/zy_thumb.gif" title="[挤眼]"></li>
                        <li><img src="biaoqing/bz_thumb.gif" title="[闭嘴]"></li>
                        <li><img src="biaoqing/bs2_thumb.gif" title="[鄙视]"></li>
                        <li><img src="biaoqing/lovea_thumb.gif" title="[爱你]"></li>
                        <li><img src="biaoqing/sada_thumb.gif" title="[泪]"></li>
                        <li><img src="biaoqing/heia_thumb.gif" title="[偷笑]"></li>
                        <li><img src="biaoqing/qq_thumb.gif" title="[亲亲]"></li>
                        <li><img src="biaoqing/sb_thumb.gif" title="[生病]"></li>
                        <li><img src="biaoqing/mb_thumb.gif" title="[太开心]"></li>
                        <li><img src="biaoqing/ldln_thumb.gif" title="[懒得理你]"></li>
                        <li><img src="biaoqing/yhh_thumb.gif" title="[右哼哼]"></li>
                        <li><img src="biaoqing/zhh_thumb.gif" title="[左哼哼]"></li>
                        <li><img src="biaoqing/x_thumb.gif" title="[嘘]"></li>
                        <li><img src="biaoqing/cry.gif" title="[衰]"></li>
                        <li><img src="biaoqing/wq_thumb.gif" title="[委屈]"></li>
                        <li><img src="biaoqing/t_thumb.gif" title="[吐]"></li>
                        <li><img src="biaoqing/k_thumb.gif" title="[打哈气]"></li>
                        <li><img src="biaoqing/bba_thumb.gif" title="[抱抱]"></li>
                        <li><img src="biaoqing/angrya_thumb.gif" title="[怒]"></li>
                        <li><img src="biaoqing/yw_thumb.gif" title="[疑问]"></li>
                        <li><img src="biaoqing/cza_thumb.gif" title="[馋嘴]"></li>
                        <li><img src="biaoqing/88_thumb.gif" title="[拜拜]"></li>
                        <li><img src="biaoqing/sk_thumb.gif" title="[思考]"></li>
                        <li><img src="biaoqing/sweata_thumb.gif" title="[汗]"></li>
                        <li><img src="biaoqing/sleepya_thumb.gif" title="[困]"></li>
                        <li><img src="biaoqing/sleepa_thumb.gif" title="[睡觉]"></li>
                        <li><img src="biaoqing/money_thumb.gif" title="[钱]"></li>
                        <li><img src="biaoqing/sw_thumb.gif" title="[失望]"></li>
                        <li><img src="biaoqing/cool_thumb.gif" title="[酷]"></li>
                        <li><img src="biaoqing/hsa_thumb.gif" title="[花心]"></li>
                        <li><img src="biaoqing/hatea_thumb.gif" title="[哼]"></li>
                        <li><img src="biaoqing/gza_thumb.gif" title="[鼓掌]"></li>
                        <li><img src="biaoqing/dizzya_thumb.gif" title="[晕]"></li>
                        <li><img src="biaoqing/bs_thumb.gif" title="[悲伤]"></li>
                        <li><img src="biaoqing/crazya_thumb.gif" title="[抓狂]"></li>
                        <li><img src="biaoqing/h_thumb.gif" title="[黑线]"></li>
                        <li><img src="biaoqing/yx_thumb.gif" title="[阴险]"></li>
                        <li><img src="biaoqing/nm_thumb.gif" title="[怒骂]"></li>
                        <li><img src="biaoqing/hearta_thumb.gif" title="[心]"></li>
                        <li><img src="biaoqing/unheart.gif" title="[伤心]"></li>
                        <li><img src="biaoqing/pig.gif" title="[猪头]"></li>
                        <li><img src="biaoqing/ok_thumb.gif" title="[ok]"></li>
                        <li><img src="biaoqing/ye_thumb.gif" title="[耶]"></li>
                        <li><img src="biaoqing/good_thumb.gif" title="[good]"></li>
                        <li><img src="biaoqing/no_thumb.gif" title="[不要]"></li>
                        <li><img src="biaoqing/z2_thumb.gif" title="[赞]"></li>
                        <li><img src="biaoqing/come_thumb.gif" title="[来]"></li>
                        <li><img src="biaoqing/sad_thumb.gif" title="[弱]"></li>
                        <li><img src="biaoqing/lazu_thumb.gif" title="[蜡烛]"></li>
                        <li><img src="biaoqing/clock_thumb.gif" title="[钟]"></li>
                        <li><img src="biaoqing/cake.gif" title="[蛋糕]"></li>
                        <li><img src="biaoqing/m_thumb.gif" title="[话筒]"></li>
                        <li><img src="biaoqing/weijin_thumb.gif" title="[围脖]"></li>
                        <li><img src="biaoqing/lxhzhuanfa_thumb.gif" title="[转发]"></li>
                        <li><img src="biaoqing/lxhluguo_thumb.gif" title="[路过这儿]"></li>
                        <li><img src="biaoqing/bofubianlian_thumb.gif" title="[bofu变脸]"></li>
                        <li><img src="biaoqing/gbzkun_thumb.gif" title="[gbz困]"></li>
                        <li><img src="biaoqing/boboshengmenqi_thumb.gif" title="[生闷气]"></li>
                        <li><img src="biaoqing/chn_buyaoya_thumb.gif" title="[不要啊]"></li>
                        <li><img src="biaoqing/daxiongleibenxiong_thumb.gif" title="[dx泪奔]"></li>
                        <li><img src="biaoqing/cat_yunqizhong_thumb.gif" title="[运气中]"></li>
                        <li><img src="biaoqing/youqian_thumb.gif" title="[有钱]"></li>
                    </ul>
                </div>
                <!--face end-->
            </div>
        </div>
        <!--qq end-->
        <!--msgCon begin-->
        <div class="msgCon" v-for="(item,index) in msgBoxList">
            <div class='msgBox'>
                <div class="headUrl">
                    <img src='biaoqing/tx.jpg' width='50' height='50'>
                    <div>
                        <span class="title">{{item.username}}</span>
                        <span class="time">{{item.shijian}}</span>
                    </div>
                    <a class="del" v-if="item.status==yonghu.status&&item.tele==yonghu.tele" v-on:click="delpl(item.id)">删除</a>
                </div>
                <div class='msgTxt' v-html="item.message">

                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    <!-- //文章详情页 -->

    <!-- 网页底部 -->
    <div id="footer"></div>
    <!-- //网页底部 -->


    <!--接收参数id，显示具体数据-->
    <script>
        //在桌面任意地方点击，关闭表情框
        $(document).click(function () {
            $(".face").slideUp(); //慢慢向上收
        });
        var product_id = oneValue();
        //接收单个值
        function oneValue(){
            var result;
            var url = window.location.search;//获取url中“？”后面的字符串
            if(url.length != -1){
                result = url.substr(url.indexOf("=")+1);
                console.info("result:" + result);//按浏览器F12，打印出来
            }
            return result;
        }
        const va=new Vue({
            el: "#app",
            mounted() {
                this.onSubmit();
                this.plusername();
                this.bqjia();
                this.itspinglun();
            },
            methods: {
                //==================宠物管理方法========================
                //获取当前时间，格式YYYY-MM-DD
                getNowFormatDate() {
                    var date = new Date();
                    var seperator1 = "-";
                    var year = date.getFullYear();
                    var month = date.getMonth() + 1;
                    var strDate = date.getDate();
                    if (month >= 1 && month <= 9) {
                        month = "0" + month;
                    }
                    if (strDate >= 0 && strDate <= 9) {
                        strDate = "0" + strDate;
                    }
                    var currentdate = year + seperator1 + month + seperator1 + strDate;
                    return currentdate;
                },
                // 查询方法
                onSubmit() {
                    var _this = this;
                    //页面加载完成之后，发送异步数据请求，查询数据
                    axios({
                        method: "post",
                        url: "http://localhost:9090/web-demo/news/selectByid?newsID=" + product_id
                    }).then(function (resp) {
                        _this.news1 = resp.data;
                        _this.imgnames = [];
                        _this.imgnames = _this.news1.newsImagePath.split("#");
                        _this.imgnames.pop();
                        axios({
                            method: "post",
                            url: "http://localhost:9090/web-demo/Regular/getUsername"
                        }).then(function (resp) {
                            if(resp.data.username==null){
                                axios({
                                    method: "post",
                                    url: "http://localhost:9090/web-demo/organization/getUsername"
                                }).then(function (resp) {

                                    _this.zan.tele=resp.data.tele;
                                    _this.zan.status=resp.data.status;
                                    _this.zan.nid=product_id;
                                    axios({
                                        method: "post",
                                        url: "http://localhost:9090/web-demo/zan/selectByid?tele="+_this.zan.tele+"&nid="+product_id+"&status="+_this.zan.status
                                    }).then(function (resp) {
                                        if(resp.data==null){
                                            _this.src="images/未赞.png";
                                        }else{
                                            _this.zan.id=resp.data.id;
                                            _this.src="images/已赞.png";
                                        }



                                    })
                                })
                            }
                            else{
                                _this.zan.tele=resp.data.tele;
                                _this.zan.status=resp.data.status;
                                _this.zan.nid=product_id;
                                axios({
                                    method: "post",
                                    url: "http://localhost:9090/web-demo/zan/selectByid?tele="+_this.zan.tele+"&nid="+product_id+"&status="+_this.zan.status
                                }).then(function (resp) {
if(resp.data==null){
    _this.src="images/未赞.png";
}else{
    _this.zan.id=resp.data.id;
    _this.src="images/已赞.png";
}



                                })
                                }
                        })
                    })
                },
                editsrc() {
                    var _this = this;
                    if(this.src=="images/未赞.png")
                    {
                        axios({
                            method: "post",
                            url: "http://localhost:9090/web-demo/zan/add",
                            data: _this.zan
                        }).then(function (resp) {
                            if (resp.data == "success") {
                                _this.src = "images/已赞.png";
                                _this.news1.newsZan++;
                                axios({
                                    method: "post",
                                    url: "http://localhost:9090/web-demo/news/update",
                                    data: _this.news1
                                }).then(function (resp) {
                                    if (resp.data == "success") {

                                    } else {
                                        console.log("点赞没成")
                                    }
                                })
                            }

                        })
                    }
                    else if(this.src=="images/已赞.png")
                    {
                        axios({
                            method: "post",
                            url: "http://localhost:9090/web-demo/zan/deleteByid?tele="+_this.zan.tele+"&nid="+_this.zan.nid+"&status="+_this.zan.status
                        }).then(function (resp) {
                            if (resp.data == "success") {
                                _this.src = "images/未赞.png";
                                _this.news1.newsZan--;
                                axios({
                                    method: "post",
                                    url: "http://localhost:9090/web-demo/news/update",
                                    data: _this.news1
                                }).then(function (resp) {
                                    if (resp.data == "success") {

                                    } else {
                                        console.log("取消点赞没成")
                                    }
                                })
                            }
                        })
                    }
                },
                bqzhan(e){
                    $(".face").slideDown(); //慢慢向下展开
                    e.stopPropagation(); //阻止冒泡事件
                },
                bqjia(){
                    $(".face ul li").click(function () {
                        let simg = $(this).find("img").clone();
                        $(".message").append(simg); //将表情添加到输入框
                    });
                },
                pinglun(){
                    var xuanze=window.confirm("确认要发布评论？");
                    if(xuanze==true)
                    {
                        var shijian = this.getNowFormatDate();
                        let txt = $(".message").html(); //获取输入框内容
                        if (!txt) {
                            $('.message').focus(); //自动获取焦点
                            return;
                        }
                        $('.message').html('') // 清空输入框
                        this.comment.shijian = shijian;
                        this.comment.ntitle = this.news1.newsTitle;
                        this.comment.username = this.yonghu.username;
                        this.comment.message = txt;
                        this.comment.nid = this.news1.newsID;
                        this.comment.tele = this.yonghu.tele;
                        this.comment.status = this.yonghu.status;
                        var _this = this;
                        axios({
                            method: "post",
                            url: "http://localhost:9090/web-demo/comment/add",
                            data: _this.comment
                        }).then(function (resp) {
                            if (resp.data == "success") {
                                window.alert("评论成功！")
                                _this.itspinglun();
                            } else {
                                window.alert("评论失败！")
                            }
                        })
                    }
                    else
                    {
                        window.alert("已取消发布！")
                    }
                },
                itspinglun(){
                    var _this = this;
                    //页面加载完成之后，发送异步数据请求，查询数据
                    axios({
                        method: "post",
                        url: "http://localhost:9090/web-demo/comment/selectAllByNid?nid=" + product_id
                    }).then(function (resp) {
                        _this.msgBoxList=resp.data;
                    })

                },
                plusername(){
                    var _this=this;
                    axios({
                        method: "post",
                        url: "http://localhost:9090/web-demo/Regular/getUsername"
                    }).then(function (resp)
                    {
                        if(resp.data.username==null)
                        {
                            axios({
                                method: "post",
                                url: "http://localhost:9090/web-demo/organization/getUsername"
                            }).then(function (resp)
                            {
                                    _this.yonghu.tele=resp.data.tele;
                                    _this.yonghu.status=resp.data.status;
                                    _this.yonghu.username=resp.data.username;
                            })
                        }
                        else
                        {
                                _this.yonghu.tele=resp.data.tele;
                                _this.yonghu.status=resp.data.status;
                                _this.yonghu.username=resp.data.username;
                        }
                    })
                },
                delpl(val){
                    var xuanze=window.confirm("确认要删除评论？");
                    if(xuanze==true)
                    {
                        var _this = this;
                        //页面加载完成之后，发送异步数据请求，查询数据
                        axios({
                            method: "post",
                            url: "http://localhost:9090/web-demo/comment/deleteByid?id="+val
                        }).then(function (resp)
                        {
                            if(resp.data=="success"){
                                window.alert("删除成功！");
                                _this.itspinglun();
                            }
                            else
                            {
                                window.alert("删除失败！");
                            }
                        })
                    }
                    else
                    {
                        window.alert("已取消删除！")
                    }

                }
                    //==================！！！宠物管理方法========================
                },
            data(){
                return {
                    //===============宠物管理部分需要的=============================
                    // 品牌模型数据
                    news1: {
                        newsID: '',
                        newsTitle: "",
                        newsContent: "",
                        newsDate: "",
                        newsImagePath: "",
                        newsIsTop: '',
                        newsZan: '',
                        newsRedu:''
                    },
                    imgnames: [],
                    zan: {
                        id: '',
                        tele: "",
                        nid: '',
                        status: ''
                    },
                    src: "",
                    comment:{
                        id:'',
                        nid:'',
                        status:'',
                        tele:"",
                        message:"",
                        shijian:"",
                        ntitle:"",
                        username:""
                    },
                    msgBoxList:[],
                    //用户
                    yonghu:{
                        tele:"",
                        status:''
                    }
                    //===============！宠物管理部分需要的！=============================
                }
            }
        })
    </script>


	<!-- start-smooth-scrolling -->
	<script src="js/easing.js"></script>
	<script>
		jQuery(document).ready(function ($) {
			$(".scroll").click(function (event) {
				event.preventDefault();

				$('html,body').animate({
					scrollTop: $(this.hash).offset().top
				}, 1000);
			});
		});
	</script>
	<!-- //end-smooth-scrolling -->

    <!-- 小轮播图js代码 -->
     <script type="text/javascript">
    window.onload = function(){
        function $(param){
            if(arguments[1] == true){
                return document.querySelectorAll(param);
            }else{
                return document.querySelector(param);
            }
        }
        var $box = $(".box");
        var $box1 = $(".box-1 ul li",true);
        var $box2 = $(".box-2 ul");
        var $box3 = $(".box-3");
        var $length = $box1.length;
        
        var str = "";
        for(var i =0;i<$length;i++){
            if(i==0){
                str +="<li class='on'>"+(i+1)+"</li>";
            }else{
                str += "<li>"+(i+1)+"</li>";
            }
        }
        $box2.innerHTML = str;
        
        var current = 0;
        
        var timer;
        timer = setInterval(go,1000);
        function go(){
            for(var j =0;j<$length;j++){
                $box1[j].style.display = "none";
                $box2.children[j].className = "";
            }
            if($length == current){
                current = 0;
            }
            $box1[current].style.display = "block";
            $box2.children[current].className = "on";
            current++;
        }
        
        for(var k=0;k<$length;k++){
            $box1[k].onmouseover = function(){
                clearInterval(timer);
            }
            $box1[k].onmouseout = function(){
                timer = setInterval(go,1000);
            }
        }
        for(var p=0;p<$box3.children.length;p++){
            $box3.children[p].onmouseover = function(){
                clearInterval(timer);
            };
            $box3.children[p].onmouseout = function(){
                timer = setInterval(go,1000);
            }
        }
        
        for(var u =0;u<$length;u++){
            $box2.children[u].index  = u;
            $box2.children[u].onmouseover = function(){
                clearInterval(timer);
                for(var j=0;j<$length;j++){
                    $box1[j].style.display = "none";
                    $box2.children[j].className = "";
                }
                this.className = "on";
                $box1[this.index].style.display = "block";
                current = this.index +1;
            }
            $box2.children[u].onmouseout = function(){
                timer = setInterval(go,1000);
            }
        }
        
        $box3.children[0].onclick = function(){
            back();
        }
        $box3.children[1].onclick = function(){
            go();
        }
        function back(){
            for(var j =0;j<$length;j++){
                $box1[j].style.display = "none";
                $box2.children[j].className = "";
            }
            if(current == 0){
                current = $length;
            }
            $box1[current-1].style.display = "block";
            $box2.children[current-1].className = "on";
            current--;
        }
    }
    </script>
    <!-- //小轮播图js代码 -->

    <!-- js -->
	<script src="js/jquery-2.2.3.min.js"></script>
    <script src="js/newsdetails.js"></script>
	<!-- Necessary-JavaScript-File-For-Bootstrap -->
	<!-- //js -->

	

    <!-- 导航栏大于一定位置就可以固定在顶部用到的js代码 -->
    <script>
		$(window).scroll(function () {
			if ($(window).scrollTop() >= 400) {
				$('nav').addClass('fixed-header');
			} else {
				$('nav').removeClass('fixed-header');
			}
		});
	</script>
    <!-- //导航栏大于一定位置就可以固定在顶部用到的js代码 -->
    

</body>
</html>